{"version":3,"file":"runtime.mjs.map","sources":["../src/runtime.js","../src/union.js","../src/effects.js"],"sourcesContent":["\n/**\n * The @composi/runtime.\n * @example\n *\n * ```\n * // Create a runtime program\n * const program = {\n *   // Define state:\n *   init() {\n *     return [{count: 0}]\n *   },\n *   // Define view to render.\n *   // Notice event to send message 'incr'.\n *   view(state, send) {\n *      return render(<div onclick={send('incr')}>The count is: {state.count}</div>, document.body)\n *   },\n *   // Define action to update state:\n *   update(state, msg) {\n *     if (msg === 'incr') {\n *        return [state.count++]\n *     }\n *   }\n * }\n * // Run the program:\n * run(program)\n * ```\n * @param {import('./types').Program} program A program to run with five methods: `init`, `view`, `update`, `subscriptions` and `done`.\n * @return {() => void} Function to terminate runtime.\n */\nexport function run(program) {\n  const {init, view, update, subs, done} = program\n  const subscriptions = subs || program.subscriptions\n  let state\n  let isRunning = true\n  let isFirstRun = true\n  const getState = () => state\n\n  /**\n   * Send a message.\n   * @param {import('./types').Message} message\n   *\n   */\n  function send(message, data) {\n    let msg = message\n    /**\n     * message is a function from a tagged union that\n     * can be called to return a message object.\n     */\n    isRunning\n     && (typeof message === 'function') \n     && (msg = /** @type {Function} */ (message)(data))\n    \n    return isRunning &&\n      updateView(update(state, msg, send))\n  }\n\n  /**\n   * Expose send as static function on program object.\n   * This is to let you send messages to the program\n   * from other contexts, such as in a @composi/router action.\n   */\n  program['send'] = send\n\n  /**\n   * Handle changes to state and executing effects.\n   * @param {any} update\n   * @return {void} undefined\n   */\n  const updateView = update => {\n    update \n      ? state = update \n      : init \n      ? state = init() \n      : state = undefined\n\n    isFirstRun\n      && subscriptions\n      && typeof subscriptions === 'function'\n      && subscriptions(send, getState)\n\n    isFirstRun = false\n    \n    view(state, send)\n  }\n  updateView(state)\n\n  /**\n   * Function to end runtime.\n   * @return {void} undefined\n   */\n  return () => {\n    isRunning\n      && done\n      && done(state)\n      \n    isRunning = false\n  }\n}\n","/**\n * Helper function for testing whether message type exists on actions object.\n */\nconst {hasOwnProperty} = Object\n\n\n/**\n * @param {import('./types').Tag} tag\n * @param {Object<string, Function>} handlers\n * @param {() => void} [catchAll]\n */\nfunction match(tag, handlers, catchAll) {\n  const {type, data} = tag\n  return type\n    ? (type => {\n      const match = hasOwnProperty.call(handlers, type) && handlers[type]\n      return match\n        ? match(data)\n        : catchAll\n        ? catchAll()\n        : console.error(\n          `The message you sent has no matching action method. Check the spelling for the message or the action method. The message type was \"${type}\".`\n        )\n    })(type)\n    : (() => {\n      console.error(\n        \"The message you provided was not valid. Messages have the format: {type: 'whatever', data?: 'something'}\"\n      )\n      console.error('The tag you provided was:')\n      console.dir(tag)\n    })()\n}\n\n/**\n * Create a union of string tags.\n * @param {string[]} types\n * @returns {Object<string, any>} Object\n */\nfunction createUnion(types) {\n  const variants = Object.create(null)\n\n  let idx = 0\n  while (idx < types.length) {\n    const type = types[idx]\n    type === 'match'\n      && console.error(\n        `The message type you provided was \"match\". This cannot be used since it would override the message union's own match method. Please change it to something else, such as \"matchName\", etc.`\n      )\n\n    variants[type] = data => ({ type, data })\n    idx++\n  }\n\n  return { variants, match }\n}\n\n/**\n * @typedef {Object} MessageUnion\n */\n\n/**\n * Create a union of types for matching up with functions. This is used to define actions for the `update` method of a runtime program.\n * @param {...string} types\n * @returns {MessageUnion} MessageUnion\n */\nexport function union(...types) {\n  const { variants, match } = createUnion(types)\n  variants.match = match\n  return variants\n}\n","/**\n * @typedef {import('./types').Send} Send\n * @typedef {import('./types').Message} Message\n * @typedef {import('./types').State} State\n * @typedef {() => State} GetState\n * @typedef {(send?: Send, getState?: GetState) => any} Effect\n */\n/**\n * Function to batch effects together.\n * @param {...Effect} effects\n * @return {(send?: Send, getState?: GetState) => void} Function\n */\nexport const batchEffects = (...effects) => (getState, send) =>\n  effects.map(effect => effect && effect(getState, send))\n\nexport const batch = batchEffects\n"],"names":["run","program","send","message","data","msg","isRunning","updateView","update","state","init","view","subs","done","subscriptions","isFirstRun","getState","hasOwnProperty","Object","match","tag","handlers","catchAll","type","call","console","error","dir","createUnion","types","variants","create","idx","length","union","batchEffects","effects","map","effect","batch"],"mappings":"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"}