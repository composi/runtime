{"version":3,"file":"runtime.js.map","sources":["../src/union.js","../src/effects.js","../src/runtime.js"],"sourcesContent":["const hasOwnProperty = Object.prototype.hasOwnProperty\n\n/**\n * @typedef {Object} Tag\n * @prop {string} type\n * @prop {any} [data]\n */\n/**\n * @param {Tag} tag\n * @param {Object<string, Function>} handlers\n */\nfunction match(tag, handlers) {\n  if (!tag.type) {\n    console.error(\n      \"The message you provided was not valid. Messages have the format: {type: 'whatever', data: 'something'}\"\n    )\n    console.error('The tag you provided was:')\n    console.dir(tag)\n    return\n  }\n  return ((tag, context) => {\n    const type = tag.type\n    const match = hasOwnProperty.call(handlers, type) && handlers[type]\n    return match(tag.data, context)\n  })(tag)\n}\n\n/**\n * Create a union of string tags.\n * @param {string[]} types\n * @returns {Object<string, any>} Object\n */\nfunction createUnion(types) {\n  const variants = Object.create(null)\n\n  let idx = 0\n  while (idx < types.length) {\n    const type = types[idx]\n    variants[type] = data => ({ type, data })\n    idx++\n  }\n\n  return { variants, match }\n}\n\n/**\n * @typedef {Object} MessageUnion\n */\n\n/**\n * Create a union of types for matching up with functions. This is used to define actions for the `update` method of a runtime program.\n * @param {...string} types\n * @returns {MessageUnion} MessageUnion\n */\nexport function union(...types) {\n  const { variants, match } = createUnion(types)\n  variants.match = match\n  return variants\n}\n","/**\n * @typedef {import('./runtime').Send} Send\n * @typedef {import('./runtime').Message} Message\n * @typedef {Object} State\n * @typedef {() => State} GetState\n * @typedef {(send?: Send, getState?: GetState) => any} Effect\n */\n/**\n * Function to batch effects together.\n * @param {...Effect} effects\n * @return {(send?: Send, getState?: GetState) => void} Function\n */\nexport const batchEffects = (...effects) => (getState, send) =>\n  effects.map(effect => effect && effect(getState, send))\n\nexport const batch = batchEffects\n","/**\n * @typedef {Object<string, any>} Message\n * @prop {string} type\n * @prop {any} [data]\n * @typedef {(msg?: Message) => Message} Send\n * @typedef {() => State} GetState\n */\n/**\n * @typedef {any} State Simple or complex types for application state.\n */\n/**\n * @typedef {State | void} InitResult Return result of program init method.\n */\n/**\n * @typedef {Object<string, any>} Program A program to run.\n * @prop {() => InitResult} init Method to set up initial state.\n * @prop {(state: State, send?: Send) => void} view Method to present the current application state.\n * @prop {(state: State, msg?: Message, send?: Send) => any} update Method to capture messages sent from view or subscriptions. According to the message, an action will transform application state and pass it the the program view method.\n * @prop {(send?: Send, getState?: GetState) => void} [subscriptions] Method to run effects when the program starts. These run independently from the rest of the program.\n * @prop {(send?: Send, getState?: GetState) => void} [subs] Shortcut for subscriptions.\n * @prop {(state: State) => void} [done] Method to do clean up when shutting down a program.\n * @prop {Send} [send] A static send function for dispatching message to a program. Used with routers and in composition.\n */\n/**\n * The @composi/runtime.\n * @example\n *\n * ```\n * // Create a runtime program\n * const program = {\n *   // Define state:\n *   init() {\n *     return [{count: 0}]\n *   },\n *   // Define view to render.\n *   // Notice event to send message 'incr'.\n *   view(state, send) {\n *      return render(<div onclick={send('incr')}>The count is: {state.count}</div>, document.body)\n *   },\n *   // Define action to update state:\n *   update(state, msg) {\n *     if (msg === 'incr') {\n *        return [state.count++]\n *     }\n *   }\n * }\n * // Run the program:\n * run(program)\n * ```\n * @param {Program} program A program to run with five methods: `init`, `view`, `update`, `subscriptions` and `done`.\n * @return {() => void} Function to terminate runtime.\n */\nexport function run(program) {\n  let init = program.init\n  const view = program.view\n  const update = program.update\n  const subscriptions = program.subscriptions || program.subs\n  const done = program.done\n  let state\n  let isRunning = true\n  let isFirstRun = true\n  const getState = () => state\n\n  /**\n   * Send a message.\n   * @param {Message} message\n   *\n   */\n  function send(message) {\n    if (isRunning) {\n      return updateView(update(state, message, send))\n    }\n  }\n\n  /**\n   * Expose send as static function on program object.\n   * This is to let you send messages to the program\n   * from other contexts, such as in a @composi/router action.\n   */\n  program['send'] = send\n\n  /**\n   * Handle changes to state and executing effects.\n   * @param {any} update\n   * @return {void} undefined\n   */\n  function updateView(update) {\n    if (update) {\n      state = update\n    } else if (init) {\n      state = init()\n    }\n    if (subscriptions && isFirstRun) {\n      if (typeof subscriptions === 'function') subscriptions(send, getState)\n      isFirstRun = false\n    }\n    view(state, send)\n  }\n  updateView(state)\n\n  /**\n   * Function to end runtime.\n   * @return {void} undefined\n   */\n  return () => {\n    if (isRunning) {\n      isRunning = false\n      if (done) {\n        done(state)\n      }\n    }\n  }\n}\n"],"names":["match","tag","handlers","type","context","hasOwnProperty","call","data","console","error","dir","createUnion","types","variants","Object","create","idx","length","prototype","batchEffects","effects","getState","send","map","effect","program","message","isRunning","updateView","update","state","init","subscriptions","isFirstRun","view","subs","done"],"mappings":"2LAWA,QAASA,CAAAA,CAAT,CAAeC,CAAf,CAAoBC,CAApB,CAA8B,OACvBD,CAAAA,CAAG,CAACE,IADmB,CASrB,CAAC,CAACF,CAAD,CAAMG,CAAN,GAAkB,IAClBD,CAAAA,CAAI,CAAGF,CAAG,CAACE,IADO,CAElBH,CAAK,CAAGK,CAAc,CAACC,IAAfD,CAAoBH,CAApBG,CAA8BF,CAA9BE,GAAuCH,CAAQ,CAACC,CAAD,CAFrC,OAGjBH,CAAAA,CAAK,CAACC,CAAG,CAACM,IAAL,CAAWH,CAAX,CAHP,CAAA,EAIJH,CAJI,CATqB,EAE1BO,OAAO,CAACC,KAARD,CACE,yGADFA,CAF0B,CAK1BA,OAAO,CAACC,KAARD,CAAc,2BAAdA,CAL0B,KAM1BA,CAAAA,OAAO,CAACE,GAARF,CAAYP,CAAZO,CAN0B,EAqB9B,QAASG,CAAAA,CAAT,CAAqBC,CAArB,CAA4B,QACpBC,CAAAA,CAAQ,CAAGC,MAAM,CAACC,MAAPD,CAAc,IAAdA,CADS,CAGtBE,CAAG,CAAG,CAHgB,iBAKlBb,CAAAA,CAAI,CAAGS,CAAK,CAACI,CAAD,EAClBH,CAAQ,CAACV,CAAD,CAARU,CAAiBN,CAAI,GAAK,CAAEJ,IAAF,CAAEA,CAAF,CAAQI,KAAAA,CAAR,CAAL,EACrBS,CAAG,GAPqB,CAInBA,CAAG,CAAGJ,CAAK,CAACK,MAJO,YAUnB,CAAEJ,QAAF,CAAEA,CAAF,CAAYb,MAAAA,CAAZ,KA1CHK,CAAAA,CAAc,CAAGS,MAAM,CAACI,SAAPJ,CAAiBT,eCY3Bc,CAAY,CAAG,sCAAIC,CAAJ,MAAA,EAAA,cAAIA,CAAJ,EAAA,CAAIA,aAAAA,OAAY,CAACC,CAAD,CAAWC,CAAX,GAC1CF,CAAO,CAACG,GAARH,CAAYI,CAAM,EAAIA,CAAM,EAAIA,CAAM,CAACH,CAAD,CAAWC,CAAX,CAAtCF,CADK,QCwCA,SAAaK,CAAb,CAAsB,SAgBlBH,CAAAA,EAAKI,EAAS,IACjBC,QACKC,CAAAA,CAAU,CAACC,CAAM,CAACC,CAAD,CAAQJ,CAAR,CAAiBJ,CAAjB,CAAP,UAgBZM,CAAAA,EAAWC,EAAQ,CACtBA,CADsB,CAExBC,CAAK,CAAGD,CAFgB,CAGfE,CAHe,GAIxBD,CAAK,CAAGC,CAAI,EAJY,EAMtBC,CAAa,EAAIC,CANK,GAOK,UAAzB,QAAOD,CAAAA,CAPa,EAOiBA,CAAa,CAACV,CAAD,CAAOD,CAAP,CAP9B,CAQxBY,CAAU,GARc,EAU1BC,CAAI,CAACJ,CAAD,CAAQR,CAAR,EA5CqB,GAMvBQ,CAAAA,CANuB,CACvBC,CAAI,CAAGN,CAAO,CAACM,IADQ,CAErBG,CAAI,CAAGT,CAAO,CAACS,IAFM,CAGrBL,CAAM,CAAGJ,CAAO,CAACI,MAHI,CAIrBG,CAAa,CAAGP,CAAO,CAACO,aAARP,EAAyBA,CAAO,CAACU,IAJ5B,CAKrBC,CAAI,CAAGX,CAAO,CAACW,IALM,CAOvBT,CAAS,GAPc,CAQvBM,CAAU,GARa,CASrBZ,CAAQ,CAAG,IAAMS,CATI,OA2B3BL,CAAAA,CAAO,KAAPA,CAAkBH,EAmBlBM,CAAU,CAACE,CAAD,EAMH,IAAM,CACPH,CADO,GAETA,CAAS,GAFA,CAGLS,CAHK,EAIPA,CAAI,CAACN,CAAD,CAJG,CAAb,WFlDK,UAAyB,4BAAPlB,CAAO,MAAA,EAAA,cAAPA,CAAO,EAAA,CAAPA,aAAAA,IACjB,CAAEC,QAAF,CAAEA,CAAF,CAAYb,MAAAA,CAAZ,EAAsBW,CAAW,CAACC,CAAD,QACvCC,CAAAA,CAAQ,CAACb,KAATa,CAAiBb,EACVa,4BC1CYM"}